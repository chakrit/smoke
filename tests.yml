---
config:
  interpreter: /bin/sh
  timeout: 5s
tests:
  - name: Builds
    checks:
      - exitcode
    commands:
      - go build -o ./bin/smoke -v .
      - ./bin/smoke
  - name: Basics
    checks:
      - exitcode
    tests:
      - name: Checks
        checks:
          - stdout
        commands:
          - goimports -l *.go checks/*.go engine/*.go internal/p/*.go specs/*.go
      - name: Unit Tests
        commands:
          - go test -v ./...
      - name: Common Switches
        commands:
          - ./bin/smoke --time -qqqq -vvvv
      - name: Loads
        checks:
          - stdout
        commands:
          - ./bin/smoke --no-color --list tests.yml
          - ./bin/smoke --no-color --list tests.yml -v
  - name: Tests
    checks:
      - exitcode
      - stdout
      - stderr
    tests:
      - name: Diff
        commands:
          - ./bin/smoke --no-color badtests.yml
      - name: Errors
        commands:
          - unknowncommand_asdfqwerzcxv # should error
      - name: I/O
        config:
          workdir: ./internal/p
        checks:
          - exitcode
          - ./internal/p/*.go # should collect *.go contents into lockfile
        commands:
          - ls # should list the files in internal/p
      - name: Env
        config:
          env:
            - "YEAS_ITS=Working"
        commands:
          - echo $YEAS_ITS
